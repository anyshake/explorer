#ifndef __FILTER_H
#define __FILTER_H

#include <math.h>
#include <stdint.h>
#include <string.h>

#define NUM_TAPS 141

#define LPF_MAG 10.7
#define BPF_MAG 1.2
#define HPF_MAG 1.0

const float LPF_COEFFS[] = {0.00011199633607875120319338768660,0.00008067136740679163651839000959,0.00004784264718537325220340528098,0.00001251281161519742915813873524,-0.00002636654700225478912710072588,-0.00006985975310042237930788222577,-0.00011900953110894378292067968816,-0.00017479779969935464278667225368,-0.00023810552967174847607823018336,-0.00030967245748712721392995050884,-0.00039005747211926015917057841698,-0.00047960050418907596275069904479,-0.00057838674279708107445890918896,-0.00068621398688324913676950256303,-0.00080256390437895416475888588081,-0.00092657792419541425144036139727,-0.00105703842380269622328037293357,-0.00119235579963171195103099897494,-0.00133056191986105219922376097230,-0.00146931036063978554331854731174,-0.00160588371896267672646330115782,-0.00173720817995496657794307626688,-0.00185987539509531452086577019145,-0.00197017160288929203681984603236,-0.00206411379677679104535648058061,-0.00213749261874868461824616971967,-0.00218592153341787146306196554235,-0.00220489171828069365974278603915,-0.00218983199370951543694108210047,-0.00213617301284243707448773363922,-0.00203941483886633818239930704408,-0.00189519695695470778359914554301,-0.00169936970186575653923855000471,-0.00144806603125920813589233571150,-0.00113777254024309353551414059069,-0.00076539859534643592004626855285,-0.00032834246658544906415436170910,0.00017544664518314229064051279483,0.00074741175187638343637569482425,0.00138833740477071641492012865626,0.00209830614473471410014182580994,0.00287666292928923181954070642519,0.00372198828719773810655424561844,0.00463208083527321453493064140616,0.00560394966421247364696256454408,0.00663381696242465110358033086868,0.00771713110107935008896706818859,0.00884859025218184304384383409570,0.01002217645672065331197142512565,0.01123119990423585706773579317996,0.01246835303096942987322037765807,0.01372577389352433972768974257406,0.01499511813107519929422206672598,0.01626763869395631001424362693797,0.01753427239209746565928860206895,0.01878573220532118309700209124458,0.02001260420080253760177768640460,0.02120544782264626240686489211384,0.02235489825592874152393463305089,0.02345176952378121362774443525723,0.02448715695196191505234040164396,0.02545253763137551167305971944188,0.02633986752532942871019017161416,0.02714167390482923047922980686053,0.02785114185144901485791102402345,0.02846219364249531411092952737363,0.02896955992623981984701586611664,0.02936884170456724452158425719972,0.02965656226484619448213742032294,0.02983020834032077198139099039054,0.02988825992676768031341971720849,0.02983020834032077198139099039054,0.02965656226484619448213742032294,0.02936884170456724799103120915333,0.02896955992623981984701586611664,0.02846219364249531411092952737363,0.02785114185144901832735797597707,0.02714167390482923394867675881414,0.02633986752532943217963712356777,0.02545253763137551514250667139549,0.02448715695196191505234040164396,0.02345176952378121709719138721084,0.02235489825592874499338158500450,0.02120544782264626240686489211384,0.02001260420080253760177768640460,0.01878573220532118656644904319819,0.01753427239209746565928860206895,0.01626763869395631348369057889158,0.01499511813107520276366901867959,0.01372577389352433972768974257406,0.01246835303096943334266732961169,0.01123119990423585880245926915677,0.01002217645672065504669490110246,0.00884859025218184477856731007250,0.00771713110107935008896706818859,0.00663381696242465197094206885708,0.00560394966421247538168604052089,0.00463208083527321453493064140616,0.00372198828719773940759685260105,0.00287666292928923268690244441359,0.00209830614473471453382269480414,0.00138833740477071663176056315336,0.00074741175187638354479591207280,0.00017544664518314229064051279483,-0.00032834246658544911836447033338,-0.00076539859534643602846648580140,-0.00113777254024309375235457508779,-0.00144806603125920856957320470570,-0.00169936970186575697291941899891,-0.00189519695695470821728001453721,-0.00203941483886633861608017603828,-0.00213617301284243750816860263342,-0.00218983199370951587062195109468,-0.00220489171828069409342365503335,-0.00218592153341787189674283453655,-0.00213749261874868505192703871387,-0.00206411379677679147903734957481,-0.00197017160288929247050071502656,-0.00185987539509531560506794267695,-0.00173720817995496744530481425528,-0.00160588371896267737698460464912,-0.00146931036063978619383985080304,-0.00133056191986105284974506446360,-0.00119235579963171216787143347204,-0.00105703842380269644012080743067,-0.00092657792419541446828079589437,-0.00080256390437895416475888588081,-0.00068621398688324913676950256303,-0.00057838674279708139971956093461,-0.00047960050418907617959113354189,-0.00039005747211926032180090428980,-0.00030967245748712737656027638167,-0.00023810552967174858449844743191,-0.00017479779969935472410183519010,-0.00011900953110894378292067968816,-0.00006985975310042237930788222577,-0.00002636654700225480606775967096,0.00001251281161519743762846820778,0.00004784264718537327930845959312,0.00008067136740679163651839000959,0.00011199633607875120319338768660};
const float BPF_COEFFS[] = {-0.00007526807798928013910812889753,-0.00006452647011726735191278203629,-0.00004300848358044650506350550789,-0.00001209487735891968491965409865,0.00002638990602838176940383649316,0.00006991298534309710419488298472,0.00011496939606242155074503075163,0.00015687489977963975525641904252,0.00018967079538443612149456463101,0.00020618995740657222173405904719,0.00019832064904026333227414491400,0.00015748641701339921106575503451,0.00007533794622645942362388488123,-0.00005537200497321218131208456215,-0.00023978434398266477382138939234,-0.00047987642692638320020964703971,-0.00077344625417608611067654678095,-0.00111324371316478751281486836433,-0.00148635734934688843941752445232,-0.00187395848957892211146536443067,-0.00225148803446211529313836230415,-0.00258934533994784358765239851152,-0.00285410461210965950284990100272,-0.00301024420471035850099816855163,-0.00302233085621581411620018009501,-0.00285755743127360812422255165188,-0.00248849259841610282936730236258,-0.00189586753848611819055214322560,-0.00107120142478219653771331909553,-0.00001905669988376065222064788263,0.00124128102214009585803344837274,0.00267488435605722080223856096381,0.00423117826403147760661038745411,0.00584494984124518494883471220191,0.00743841672354522004395604994897,0.00892432897814871874120346006976,0.01021000737726332659172090444599,0.01120214990275513779194316299481,0.01181217319431498991022522204730,0.01196180132496286151189135438244,0.01158857518869337022149323956910,0.01065093553421766862931985286878,0.00913253379785883626085229991531,0.00704544857459327069498788986834,0.00443203154655118312238437638939,0.00136517317356760333954546204893,-0.00205313780986796610983358135627,-0.00569499060510987586969378071444,-0.00941139023707773456073333306904,-0.01303857875434142818416027864714,-0.01640556287958443160146515538145,-0.01934248510310895841080025547853,-0.02168940738271153342853203582763,-0.02330503210159044075178158550443,-0.02407486742090395731574758997340,-0.02391835571963070103396198362589,-0.02279452472894376649503733744950,-0.02070578967334525677390644204934,-0.01769962785538163260734556558873,-0.01386795966383155657986048225894,-0.00934419559942828263643388453374,-0.00429804028154394651001224403331,0.00107172631218462564850479878942,0.00654615077936067032982059288315,0.01189624980546237671685805281641,0.01689387545082601110868480986937,0.02132273306278998845075811630068,0.02498896555339471386991689882962,0.02773073433219563899143622620613,0.02942627676637294548145362682590,0.03000000000000000582867087928207,0.02942627676637294548145362682590,0.02773073433219563899143622620613,0.02498896555339471733936385078323,0.02132273306278998845075811630068,0.01689387545082601110868480986937,0.01189624980546237845158152879321,0.00654615077936067032982059288315,0.00107172631218462586534523328652,-0.00429804028154394651001224403331,-0.00934419559942828263643388453374,-0.01386795966383155831458395823574,-0.01769962785538163607679251754234,-0.02070578967334525677390644204934,-0.02279452472894376649503733744950,-0.02391835571963070450340893557950,-0.02407486742090395731574758997340,-0.02330503210159044769067548941166,-0.02168940738271154036742593973486,-0.01934248510310895841080025547853,-0.01640556287958443507091210733506,-0.01303857875434142991888375462395,-0.00941139023707773629545680904585,-0.00569499060510987760441725669125,-0.00205313780986796610983358135627,0.00136517317356760355638589654603,0.00443203154655118485710785236620,0.00704544857459327069498788986834,0.00913253379785883973029925186893,0.01065093553421767209876680482239,0.01158857518869337195621671554591,0.01196180132496286324661483035925,0.01181217319431499337967217400092,0.01120214990275513779194316299481,0.01021000737726333006116785639961,0.00892432897814872047592693604656,0.00743841672354522177867952592578,0.00584494984124518668355818817872,0.00423117826403147847397212544251,0.00267488435605722166960029895222,0.00124128102214009607487388286984,-0.00001905669988376065899691146066,-0.00107120142478219697139418808973,-0.00189586753848611884107344671690,-0.00248849259841610326304817135679,-0.00285755743127360899158428964029,-0.00302233085621581498356191808341,-0.00301024420471035936835990654004,-0.00285410461210966123757337697953,-0.00258934533994784445501413649993,-0.00225148803446211616050010029255,-0.00187395848957892297882710241907,-0.00148635734934688908993882794363,-0.00111324371316478772965530286143,-0.00077344625417608632751698127805,-0.00047987642692638336283997291254,-0.00023978434398266477382138939234,-0.00005537200497321218131208456215,0.00007533794622645945072893919336,0.00015748641701339929238091797092,0.00019832064904026341358930785042,0.00020618995740657233015427629574,0.00018967079538443620280972756742,0.00015687489977963983657158197893,0.00011496939606242155074503075163,0.00006991298534309710419488298472,0.00002638990602838178634449543825,-0.00001209487735891969338998357120,-0.00004300848358044653216855982003,-0.00006452647011726735191278203629,-0.00007526807798928013910812889753};
const float HPF_COEFFS[] = {-0.00011199633607875120319338768660,-0.00008067136740679163651839000959,-0.00004784264718537325220340528098,-0.00001251281161519742915813873524,0.00002636654700225478912710072588,0.00006985975310042237930788222577,0.00011900953110894378292067968816,0.00017479779969935464278667225368,0.00023810552967174847607823018336,0.00030967245748712721392995050884,0.00039005747211926015917057841698,0.00047960050418907596275069904479,0.00057838674279708107445890918896,0.00068621398688324913676950256303,0.00080256390437895416475888588081,0.00092657792419541425144036139727,0.00105703842380269622328037293357,0.00119235579963171195103099897494,0.00133056191986105219922376097230,0.00146931036063978554331854731174,0.00160588371896267672646330115782,0.00173720817995496657794307626688,0.00185987539509531452086577019145,0.00197017160288929203681984603236,0.00206411379677679104535648058061,0.00213749261874868461824616971967,0.00218592153341787146306196554235,0.00220489171828069365974278603915,0.00218983199370951543694108210047,0.00213617301284243707448773363922,0.00203941483886633818239930704408,0.00189519695695470778359914554301,0.00169936970186575653923855000471,0.00144806603125920813589233571150,0.00113777254024309353551414059069,0.00076539859534643592004626855285,0.00032834246658544906415436170910,-0.00017544664518314229064051279483,-0.00074741175187638343637569482425,-0.00138833740477071641492012865626,-0.00209830614473471410014182580994,-0.00287666292928923181954070642519,-0.00372198828719773810655424561844,-0.00463208083527321453493064140616,-0.00560394966421247364696256454408,-0.00663381696242465110358033086868,-0.00771713110107935008896706818859,-0.00884859025218184304384383409570,-0.01002217645672065331197142512565,-0.01123119990423585706773579317996,-0.01246835303096942987322037765807,-0.01372577389352433972768974257406,-0.01499511813107519929422206672598,-0.01626763869395631001424362693797,-0.01753427239209746565928860206895,-0.01878573220532118309700209124458,-0.02001260420080253760177768640460,-0.02120544782264626240686489211384,-0.02235489825592874152393463305089,-0.02345176952378121362774443525723,-0.02448715695196191505234040164396,-0.02545253763137551167305971944188,-0.02633986752532942871019017161416,-0.02714167390482923047922980686053,-0.02785114185144901485791102402345,-0.02846219364249531411092952737363,-0.02896955992623981984701586611664,-0.02936884170456724452158425719972,-0.02965656226484619448213742032294,-0.02983020834032077198139099039054,0.97011174007323230927823942693067,-0.02983020834032077198139099039054,-0.02965656226484619448213742032294,-0.02936884170456724799103120915333,-0.02896955992623981984701586611664,-0.02846219364249531411092952737363,-0.02785114185144901832735797597707,-0.02714167390482923394867675881414,-0.02633986752532943217963712356777,-0.02545253763137551514250667139549,-0.02448715695196191505234040164396,-0.02345176952378121709719138721084,-0.02235489825592874499338158500450,-0.02120544782264626240686489211384,-0.02001260420080253760177768640460,-0.01878573220532118656644904319819,-0.01753427239209746565928860206895,-0.01626763869395631348369057889158,-0.01499511813107520276366901867959,-0.01372577389352433972768974257406,-0.01246835303096943334266732961169,-0.01123119990423585880245926915677,-0.01002217645672065504669490110246,-0.00884859025218184477856731007250,-0.00771713110107935008896706818859,-0.00663381696242465197094206885708,-0.00560394966421247538168604052089,-0.00463208083527321453493064140616,-0.00372198828719773940759685260105,-0.00287666292928923268690244441359,-0.00209830614473471453382269480414,-0.00138833740477071663176056315336,-0.00074741175187638354479591207280,-0.00017544664518314229064051279483,0.00032834246658544911836447033338,0.00076539859534643602846648580140,0.00113777254024309375235457508779,0.00144806603125920856957320470570,0.00169936970186575697291941899891,0.00189519695695470821728001453721,0.00203941483886633861608017603828,0.00213617301284243750816860263342,0.00218983199370951587062195109468,0.00220489171828069409342365503335,0.00218592153341787189674283453655,0.00213749261874868505192703871387,0.00206411379677679147903734957481,0.00197017160288929247050071502656,0.00185987539509531560506794267695,0.00173720817995496744530481425528,0.00160588371896267737698460464912,0.00146931036063978619383985080304,0.00133056191986105284974506446360,0.00119235579963171216787143347204,0.00105703842380269644012080743067,0.00092657792419541446828079589437,0.00080256390437895416475888588081,0.00068621398688324913676950256303,0.00057838674279708139971956093461,0.00047960050418907617959113354189,0.00039005747211926032180090428980,0.00030967245748712737656027638167,0.00023810552967174858449844743191,0.00017479779969935472410183519010,0.00011900953110894378292067968816,0.00006985975310042237930788222577,0.00002636654700225480606775967096,-0.00001251281161519743762846820778,-0.00004784264718537327930845959312,-0.00008067136740679163651839000959,-0.00011199633607875120319338768660};

typedef struct {
    float coeffs[NUM_TAPS];
    float state[NUM_TAPS - 1];
} filter_fir_t;

void filter_fir_apply(filter_fir_t* filter, float* input, uint16_t input_size, float* output);
void apply_data_compensation(int32_t* arr, uint16_t len, filter_fir_t* lowpass_filter, filter_fir_t* bandpass_filter, filter_fir_t* highpass_filter);

#endif
