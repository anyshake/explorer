#ifndef __FILTER_H
#define __FILTER_H

#include <math.h>
#include <stdint.h>
#include <string.h>

#define NUM_TAPS 141

#define LPF_MAG 35.0
#define BPF_MAG 5.0
#define HPF_MAG 1.0

const float LPF_COEFFS[] = {0.00094533144689867485126882895585, 0.00095448104062069015918884362648, 0.00097464760021689911262399164116, 0.00100592032724916287216021526518, 0.00104836249844821646076686860738, 0.00110201115305648541728422706854, 0.00116687684449216897038248408336, 0.00124294345726754310033079775621, 0.00133016808992534457667389347080, 0.00142848100458534675062660657119, 0.00153778564351939170048999550033, 0.00165795871299749520387523116227, 0.00178885033447087051991508666049, 0.00193028426298016237902532843407, 0.00208205817249939618973630928167, 0.00224394400774856903404974595162, 0.00241568840183101251131714271025, 0.00259701315887596317910634979853, 0.00278761580069294403680379978994, 0.00298717017627269515456234216799, 0.00319532713280036529887584428877, 0.00341171524668063995064382076805, 0.00363594161291208714179012950751, 0.00386759269098963399252655293026, 0.00410623520536015224058346007041, 0.00435141709830715907314502288727, 0.00460266853299699102430864172675, 0.00485950294428075593722304859057, 0.00512141813471468469731728845318, 0.00538789741313602885824929344949, 0.00565841077301321507264653121183, 0.00593241610767763702383170709709, 0.00620936045944063281371017026800, 0.00648868129950315366410995565616, 0.00676980783547771053365593729723, 0.00705216234326248771896450406871, 0.00733516151993652068541429400739, 0.00761821785428243303250894769008, 0.00790074101148993332421888169392, 0.00818213922854898328962391929053, 0.00846182071680652916900733373495, 0.00873919506813510341136641557114, 0.00901367466114527150777835373674, 0.00928467606386727470346720281213, 0.00955162142932994458199846832258, 0.00981393988047742776847925938455, 0.01007106888088586497953524911964, 0.01032245558777377357484450470793, 0.01056755818384037641510797556066, 0.01080584718451614231748969530145, 0.01103680671726904247154088523075, 0.01125993576967813762645942432528, 0.01147474940306305452031310210259, 0.01168077992854378056863939860932, 0.01187757804249892600034765877126, 0.01206471391849322540024136429793, 0.01224177825285483953154930247820, 0.01240838326120094481375133455003, 0.01256416362333509159632249918559, 0.01270877737407171033379160718368, 0.01284190673768181682745659344391, 0.01296325890379878241487343615290, 0.01307256674277359337343895617778, 0.01316958945862521830616476137266, 0.01325411317789280951640051853246, 0.01332595147286209404102752529298, 0.01338494581780820015526334287870, 0.01343096597707064444870983521696, 0.01346391032395290524026343348396, 0.01348370608961853983620571284519, 0.01349030954133733674338291308459, 0.01348370608961853983620571284519, 0.01346391032395290524026343348396, 0.01343096597707064444870983521696, 0.01338494581780820015526334287870, 0.01332595147286209404102752529298, 0.01325411317789281298584747048608, 0.01316958945862522004088823734946, 0.01307256674277359510816243215459, 0.01296325890379878414959691212971, 0.01284190673768181682745659344391, 0.01270877737407171206851508316049, 0.01256416362333509333104597516240, 0.01240838326120094481375133455003, 0.01224177825285483953154930247820, 0.01206471391849322713496484027473, 0.01187757804249892600034765877126, 0.01168077992854378403808635056293, 0.01147474940306305798976005405621, 0.01125993576967813762645942432528, 0.01103680671726904594098783718437, 0.01080584718451614405221317127825, 0.01056755818384037814983145153747, 0.01032245558777377704429145666154, 0.01007106888088586497953524911964, 0.00981393988047742950320273536136, 0.00955162142932994805144542027620, 0.00928467606386727470346720281213, 0.00901367466114527497722530569035, 0.00873919506813510514608989154794, 0.00846182071680653090373080971176, 0.00818213922854898328962391929053, 0.00790074101148993505894235767073, 0.00761821785428243303250894769008, 0.00733516151993652242013776998419, 0.00705216234326248945368798004552, 0.00676980783547771140101767528563, 0.00648868129950315539883343163297, 0.00620936045944063454843364624480, 0.00593241610767763789119344508549, 0.00565841077301321594000826920023, 0.00538789741313603059297276942630, 0.00512141813471468556467902644158, 0.00485950294428075680458478657897, 0.00460266853299699189167037971515, 0.00435141709830716080786849886408, 0.00410623520536015224058346007041, 0.00386759269098963572725002890706, 0.00363594161291208931019447447852, 0.00341171524668064125168642775066, 0.00319532713280036659991845127138, 0.00298717017627269645560494915060, 0.00278761580069294533784640677254, 0.00259701315887596404646808778693, 0.00241568840183101294499801170446, 0.00224394400774856990141148394002, 0.00208205817249939618973630928167, 0.00193028426298016237902532843407, 0.00178885033447087117043639015179, 0.00165795871299749607123696915068, 0.00153778564351939235101129899164, 0.00142848100458534740114791006249, 0.00133016808992534522719519696210, 0.00124294345726754396769253574462, 0.00116687684449216897038248408336, 0.00110201115305648541728422706854, 0.00104836249844821711128817209868, 0.00100592032724916352268151875649, 0.00097464760021689987156551238101, 0.00095448104062069015918884362648, 0.00094533144689867485126882895585};
const float BPF_COEFFS[] = {-0.00065329323587415765676317258581, -0.00063635680418629950606118628187, -0.00061833612391287977750470306049, -0.00059830469814021124651259864180, -0.00057505640802957833698089151753, -0.00054720139639141836783442496284, -0.00051328536076662397476949584174, -0.00047192729963749506950226875190, -0.00042196961893527739056314329602, -0.00036263358421375127809554994585, -0.00029367244128834362479688047110, -0.00021551416057552898533633545242, -0.00012938571323296380066215915949, -0.00003741107435905189330547712667, 0.00005732422854872570286335203837, 0.00015074825620746919500013427662, 0.00023782247347405981868773139354, 0.00031260971411768061298946941307, 0.00036839203776180154490532681066, 0.00039783833135793536138133386082, 0.00039321952045657447517498783718, 0.00034666724262215901008685192686, 0.00025046987022657045450849122581, 0.00009739792692317637346540587506, -0.00011895070618167356705022208452, -0.00040379678436384502764056048107, -0.00076082894516175882289321652507, -0.00119186894590980405062019542584, -0.00169656590547418687116298929851, -0.00227213239441997980755383323981, -0.00291313459613824505406443066136, -0.00361134768959606340665846602178, -0.00435568610117892211774925925738, -0.00513221637280358768812282832528, -0.00592425814493647076575122412123, -0.00671257621852873985479615015493, -0.00747566391289729813285358517305, -0.00819011506030485787743788961279, -0.00883107906226239351699103252713, -0.00937279057115423912260876448954, -0.00978916264831314851535548626771, -0.01005442977854415463612181014241, -0.01014382497834254506785534033497, -0.01003427349934627940686304725659, -0.00970508436745228832143173036684, -0.00913862026547550103383610320407, -0.00832092610158496545635919972028, -0.00724229702817378966084316260776, -0.00589776768926353420902097823841, -0.00428750606331843985702390043002, -0.00241709739827595257791181815321, -0.00029770635480117965936813773098, 0.00205389148599622369667505594748, 0.00461541421556826373523430007140, 0.00735931613464833184190538872826, 0.01025316631480122954445111105315, 0.01326015747436943940928966156889, 0.01633973574982203191829910338129, 0.01944833842976956966852597474826, 0.02254022350743626820768206187040, 0.02556837209784543207824469845946, 0.02848544244704747513408094050646, 0.03124475250719881830319124560447, 0.03380126692164233531689987444224, 0.03611256379850290298971771107972, 0.03813975687015417476155576537167, 0.03984834953921776584673253296387, 0.04120899887889431512100202326110, 0.04219816984567315715226598626941, 0.04279866271615485884272089833757, 0.04300000000000000349720252756924, 0.04279866271615485884272089833757, 0.04219816984567315715226598626941, 0.04120899887889432205989592716833, 0.03984834953921776584673253296387, 0.03813975687015417476155576537167, 0.03611256379850290298971771107972, 0.03380126692164234225579377834947, 0.03124475250719882177263819755808, 0.02848544244704747860352789246008, 0.02556837209784543207824469845946, 0.02254022350743627167712901382401, 0.01944833842976956966852597474826, 0.01633973574982203191829910338129, 0.01326015747436943940928966156889, 0.01025316631480123127917458702996, 0.00735931613464833270926712671667, 0.00461541421556826460259603805980, 0.00205389148599622413035592494168, -0.00029770635480117965936813773098, -0.00241709739827595344527355614161, -0.00428750606331843985702390043002, -0.00589776768926353507638271622682, -0.00724229702817379226292837657297, -0.00832092610158496545635919972028, -0.00913862026547550276855957918087, -0.00970508436745229179087868232045, -0.01003427349934627940686304725659, -0.01014382497834254853730229228859, -0.01005442977854415810556876209603, -0.00978916264831315025007896224452, -0.00937279057115424085733224046635, -0.00883107906226239525171450850394, -0.00819011506030485787743788961279, -0.00747566391289729900021532316146, -0.00671257621852874158951962613173, -0.00592425814493647163311296210964, -0.00513221637280358855548456631368, -0.00435568610117892298511099724578, -0.00361134768959606427402020401018, -0.00291313459613824548774529965556, -0.00227213239441998067491557122821, -0.00169656590547418752168429278981, -0.00119186894590980448430106442004, -0.00076082894516175903973365102217, -0.00040379678436384513606077772963, -0.00011895070618167358060274924059, 0.00009739792692317640057046018720, 0.00025046987022657061713881709863, 0.00034666724262215917271717779968, 0.00039321952045657463780531371000, 0.00039783833135793552401165973365, 0.00036839203776180176174576130776, 0.00031260971411768072140968666162, 0.00023782247347405990000289432995, 0.00015074825620746922210518858876, 0.00005732422854872570286335203837, -0.00003741107435905189330547712667, -0.00012938571323296385487226778377, -0.00021551416057552906665149838883, -0.00029367244128834378742720634392, -0.00036263358421375144072587581867, -0.00042196961893527760740357779312, -0.00047192729963749534055281187328, -0.00051328536076662397476949584174, -0.00054720139639141836783442496284, -0.00057505640802957877066176051173, -0.00059830469814021168019346763600, -0.00061833612391288021118557205469, -0.00063635680418629950606118628187, -0.00065329323587415765676317258581};
const float HPF_COEFFS[] = {-0.00094533144689867485126882895585, -0.00095448104062069015918884362648, -0.00097464760021689911262399164116, -0.00100592032724916287216021526518, -0.00104836249844821646076686860738, -0.00110201115305648541728422706854, -0.00116687684449216897038248408336, -0.00124294345726754310033079775621, -0.00133016808992534457667389347080, -0.00142848100458534675062660657119, -0.00153778564351939170048999550033, -0.00165795871299749520387523116227, -0.00178885033447087051991508666049, -0.00193028426298016237902532843407, -0.00208205817249939618973630928167, -0.00224394400774856903404974595162, -0.00241568840183101251131714271025, -0.00259701315887596317910634979853, -0.00278761580069294403680379978994, -0.00298717017627269515456234216799, -0.00319532713280036529887584428877, -0.00341171524668063995064382076805, -0.00363594161291208714179012950751, -0.00386759269098963399252655293026, -0.00410623520536015224058346007041, -0.00435141709830715907314502288727, -0.00460266853299699102430864172675, -0.00485950294428075593722304859057, -0.00512141813471468469731728845318, -0.00538789741313602885824929344949, -0.00565841077301321507264653121183, -0.00593241610767763702383170709709, -0.00620936045944063281371017026800, -0.00648868129950315366410995565616, -0.00676980783547771053365593729723, -0.00705216234326248771896450406871, -0.00733516151993652068541429400739, -0.00761821785428243303250894769008, -0.00790074101148993332421888169392, -0.00818213922854898328962391929053, -0.00846182071680652916900733373495, -0.00873919506813510341136641557114, -0.00901367466114527150777835373674, -0.00928467606386727470346720281213, -0.00955162142932994458199846832258, -0.00981393988047742776847925938455, -0.01007106888088586497953524911964, -0.01032245558777377357484450470793, -0.01056755818384037641510797556066, -0.01080584718451614231748969530145, -0.01103680671726904247154088523075, -0.01125993576967813762645942432528, -0.01147474940306305452031310210259, -0.01168077992854378056863939860932, -0.01187757804249892600034765877126, -0.01206471391849322540024136429793, -0.01224177825285483953154930247820, -0.01240838326120094481375133455003, -0.01256416362333509159632249918559, -0.01270877737407171033379160718368, -0.01284190673768181682745659344391, -0.01296325890379878241487343615290, -0.01307256674277359337343895617778, -0.01316958945862521830616476137266, -0.01325411317789280951640051853246, -0.01332595147286209404102752529298, -0.01338494581780820015526334287870, -0.01343096597707064444870983521696, -0.01346391032395290524026343348396, -0.01348370608961853983620571284519, 0.98650969045866265805244665898499, -0.01348370608961853983620571284519, -0.01346391032395290524026343348396, -0.01343096597707064444870983521696, -0.01338494581780820015526334287870, -0.01332595147286209404102752529298, -0.01325411317789281298584747048608, -0.01316958945862522004088823734946, -0.01307256674277359510816243215459, -0.01296325890379878414959691212971, -0.01284190673768181682745659344391, -0.01270877737407171206851508316049, -0.01256416362333509333104597516240, -0.01240838326120094481375133455003, -0.01224177825285483953154930247820, -0.01206471391849322713496484027473, -0.01187757804249892600034765877126, -0.01168077992854378403808635056293, -0.01147474940306305798976005405621, -0.01125993576967813762645942432528, -0.01103680671726904594098783718437, -0.01080584718451614405221317127825, -0.01056755818384037814983145153747, -0.01032245558777377704429145666154, -0.01007106888088586497953524911964, -0.00981393988047742950320273536136, -0.00955162142932994805144542027620, -0.00928467606386727470346720281213, -0.00901367466114527497722530569035, -0.00873919506813510514608989154794, -0.00846182071680653090373080971176, -0.00818213922854898328962391929053, -0.00790074101148993505894235767073, -0.00761821785428243303250894769008, -0.00733516151993652242013776998419, -0.00705216234326248945368798004552, -0.00676980783547771140101767528563, -0.00648868129950315539883343163297, -0.00620936045944063454843364624480, -0.00593241610767763789119344508549, -0.00565841077301321594000826920023, -0.00538789741313603059297276942630, -0.00512141813471468556467902644158, -0.00485950294428075680458478657897, -0.00460266853299699189167037971515, -0.00435141709830716080786849886408, -0.00410623520536015224058346007041, -0.00386759269098963572725002890706, -0.00363594161291208931019447447852, -0.00341171524668064125168642775066, -0.00319532713280036659991845127138, -0.00298717017627269645560494915060, -0.00278761580069294533784640677254, -0.00259701315887596404646808778693, -0.00241568840183101294499801170446, -0.00224394400774856990141148394002, -0.00208205817249939618973630928167, -0.00193028426298016237902532843407, -0.00178885033447087117043639015179, -0.00165795871299749607123696915068, -0.00153778564351939235101129899164, -0.00142848100458534740114791006249, -0.00133016808992534522719519696210, -0.00124294345726754396769253574462, -0.00116687684449216897038248408336, -0.00110201115305648541728422706854, -0.00104836249844821711128817209868, -0.00100592032724916352268151875649, -0.00097464760021689987156551238101, -0.00095448104062069015918884362648, -0.00094533144689867485126882895585};

typedef struct {
    float coeffs[NUM_TAPS];
    float state[NUM_TAPS - 1];
} filter_fir_t;

void filter_fir_apply(filter_fir_t* filter, float* input, uint16_t input_size, float* output);
void apply_data_compensation(int32_t* arr, uint16_t len, filter_fir_t* lowpass_filter, filter_fir_t* bandpass_filter, filter_fir_t* highpass_filter);

#endif
