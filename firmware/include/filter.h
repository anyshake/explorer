#ifndef __FILTER_H
#define __FILTER_H

#include <math.h>
#include <stdint.h>
#include <string.h>

#define NUM_TAPS 131

const float LPF_COEFFS[] = {0.00028934607426817749538036639301, 0.00030525119825543516223487205963, 0.00032564830249409037381605469541, 0.00035107529243613374864835252609, 0.00038205895699208210344530178837, 0.00041911158261758065099109038520, 0.00046272759938248360410753545757, 0.00051338027864419530366113519904, 0.00057151850182018634240199705943, 0.00063756361951252174796039851046, 0.00071190641988062223870226130629, 0.00079490422468884503522795759167, 0.00088687813087487865799929398491, 0.00098811041479629209242918630451, 0.00109884211551923311606104860516, 0.00121927081261944520416962145504, 0.00134954861297609837560151913038, 0.00148978035995883748704438076516, 0.00164002207724375554005746824515, 0.00180027965825114663091233158099, 0.00197050781088380913205759803475, 0.00215060926586673958893491942490, 0.00234043425555500094956129508716, 0.00253978026859459941541596883496, 0.00274839208429976129127725315016, 0.00296596208905784350373657787259, 0.00319213087549915282975510066876, 0.00342648812358235669087158647983, 0.00366857376115608656980127122438, 0.00391787939997316307649821709447, 0.00417385004156472193270754900141, 0.00443588604583680483350871526227, 0.00470334535374061779577914421679, 0.00497554595389872959115828976451, 0.00525176858165163178149281719698, 0.00553125963763077994894690192496, 0.00581323431167356068083318376694, 0.00609687989668038742008260300054, 0.00638135927588155075357301271310, 0.00666581456593850953801227987583, 0.00694937089735715284727346485738, 0.00723114031284521809744836318146, 0.00751022576350753208462851517879, 0.00778572518214570331862578456139, 0.00805673561241735530780161411712, 0.00832235737221705129673665624068, 0.00858169822936941800728405382870, 0.00883387756757666835205622390959, 0.00907803052053833894885492838966, 0.00931331205226177717693136770549, 0.00953890096180686451743380160906, 0.00975400379105667916790345373101, 0.00995785861457599077994906622280, 0.01014973869120818633637881589493, 0.01032895595776656474940047303335, 0.01049486434599269241152441622944, 0.01064686290487918372826836588274, 0.01078439871148109685528027057444, 0.01090696955446358168417830825092, 0.01101412637584703486937076633012, 0.01110547545770796361297438892279, 0.01118068034196665477830734403142, 0.01123946347283369395775309840246, 0.01128160755298823758607795753051, 0.01130695660611303124398752117941, 0.01131541674000563837965138702657, 0.01130695660611303124398752117941, 0.01128160755298823758607795753051, 0.01123946347283369222302962242566, 0.01118068034196665477830734403142, 0.01110547545770796361297438892279, 0.01101412637584703313464729035331, 0.01090696955446358168417830825092, 0.01078439871148109685528027057444, 0.01064686290487918372826836588274, 0.01049486434599269241152441622944, 0.01032895595776656474940047303335, 0.01014973869120818633637881589493, 0.00995785861457599077994906622280, 0.00975400379105667916790345373101, 0.00953890096180686451743380160906, 0.00931331205226178064637831965911, 0.00907803052053834068357840436647, 0.00883387756757666661733274793278, 0.00858169822936941974200752980551, 0.00832235737221705129673665624068, 0.00805673561241735704252509009393, 0.00778572518214570678807273651501, 0.00751022576350753468671372914400, 0.00723114031284521723008662519305, 0.00694937089735715544935867882259, 0.00666581456593851127273575585264, 0.00638135927588155162093475070151, 0.00609687989668039175689129294256, 0.00581323431167355981347144577853, 0.00553125963763077908158516393655, 0.00525176858165163264885455518538, 0.00497554595389873045852002775291, 0.00470334535374061866314088220520, 0.00443588604583680483350871526227, 0.00417385004156472280006928698981, 0.00391787939997316220913647910606, 0.00366857376115608873820561619539, 0.00342648812358235799191419346243, 0.00319213087549915369711683865717, 0.00296596208905784350373657787259, 0.00274839208429976129127725315016, 0.00253978026859460201750118280017, 0.00234043425555500311796564005817, 0.00215060926586674132365839540171, 0.00197050781088380999941933602315, 0.00180027965825114749827406956939, 0.00164002207724375597373833723935, 0.00148978035995883900492742224486, 0.00134954861297609989348456061009, 0.00121927081261944455364831796373, 0.00109884211551923376658235209646, 0.00098811041479629209242918630451, 0.00088687813087487898325994573057, 0.00079490422468884633627056457428, 0.00071190641988062310606399929469, 0.00063756361951252142269974676481, 0.00057151850182018688450308330218, 0.00051338027864419562892178694469, 0.00046272759938248382094796995467, 0.00041911158261758086783152488231, 0.00038205895699208210344530178837, 0.00035107529243613374864835252609, 0.00032564830249409037381605469541, 0.00030525119825543516223487205963, 0.00028934607426817749538036639301};
const float BPF_COEFFS[] = {-0.00057449450086537775638645397791, -0.00060912309493449086697514083255, -0.00065143870386470182666516226533, -0.00070227158044454483093455010589, -0.00076228642090910773802814315303, -0.00083195071827581786733096791409, -0.00091150544211924991021972486394, -0.00100093864561785501204882464776, -0.00109996256583001186975245833111, -0.00120799473833384306102611827072, -0.00132414359316993662796235753376, -0.00144719893619200522943968323375, -0.00157562764933866488598068755778, -0.00170757486600656063074898938225, -0.00184087079476779420447729584964, -0.00197304327737360439901093123183, -0.00210133607664652949029160389216, -0.00222273279787473269572539713579, -0.00233398625511737961221725434768, -0.00243165300286246307062687499467, -0.00251213266519955541467012949397, -0.00257171161050578044038328329179, -0.00260661044097200639627076590443, -0.00261303469442587940271827129379, -0.00258722809205524408027176974656, -0.00252552761090489357939659065266, -0.00242441961538620654251219299624, -0.00228059624833198406820833348263, -0.00209101126001535412429754856589, -0.00185293444352724909034157985133, -0.00156400384728510710025117802502, -0.00122227495035093724172481355339, -0.00082626601360290046968670729655, -0.00037499885937179169501098918715, 0.00013196561652742107642599656003, 0.00069449783400208004498915803637, 0.00131187638001514913707601373005, 0.00198277180085732786241070613187, 0.00270523772388688021894864732531, 0.00347670960003816469086057594495, 0.00429401125560449452300826322926, 0.00515336933491197454748622419629, 0.00605043560606620053898829780792, 0.00698031699157132187738561412971, 0.00793761307591632318814145463648, 0.00891646073482328140047403763901, 0.00991058542736047813626054647784, 0.01091335859409619038484784425691, 0.01191786051339087035283448301470, 0.01291694788518623661366380162008, 0.01390332533852309607191877205423, 0.01486961999664254858999345998427, 0.01580845818288047904820459166331, 0.01671254331246634777796700177532, 0.01757473399041414169330366235044, 0.01838812132438356894414965836404, 0.01914610446392923243097428098736, 0.01984246339397716107910696337058, 0.02047142804049724082449124296090, 0.02102774278979932520705631304736, 0.02150672557909308335588605132216, 0.02190432078415067290722006987380, 0.02221714520914978840959719263992, 0.02244252657294173308732965210766, 0.02257853398382300008639944621791, 0.02262400000000000174771308536492, 0.02257853398382300008639944621791, 0.02244252657294173308732965210766, 0.02221714520914978494015024068631, 0.02190432078415067290722006987380, 0.02150672557909308335588605132216, 0.02102774278979932173760936109375, 0.02047142804049724082449124296090, 0.01984246339397716454855391532419, 0.01914610446392923243097428098736, 0.01838812132438356894414965836404, 0.01757473399041414169330366235044, 0.01671254331246634777796700177532, 0.01580845818288047904820459166331, 0.01486961999664254858999345998427, 0.01390332533852309607191877205423, 0.01291694788518624008311075357369, 0.01191786051339087382228143496832, 0.01091335859409618691540089230330, 0.00991058542736047813626054647784, 0.00891646073482328313519751361582, 0.00793761307591632318814145463648, 0.00698031699157132534683256608332, 0.00605043560606620314107351177313, 0.00515336933491197454748622419629, 0.00429401125560449625773173920606, 0.00347670960003816599190318292756, 0.00270523772388688065262951631951, 0.00198277180085732916345331311447, 0.00131187638001514892023557923295, 0.00069449783400207993656894078782, 0.00013196561652742110353105087217, -0.00037499885937179180343120643570, -0.00082626601360290068652714179365, -0.00122227495035093724172481355339, -0.00156400384728510731709161252212, -0.00185293444352724865666071085712, -0.00209101126001535542534015554850, -0.00228059624833198493557007147103, -0.00242441961538620697619306199044, -0.00252552761090489357939659065266, -0.00258722809205524408027176974656, -0.00261303469442588200480348525900, -0.00260661044097200943203684886385, -0.00257171161050578217510675926860, -0.00251213266519955671571273647658, -0.00243165300286246393798861298308, -0.00233398625511738004589812334189, -0.00222273279787473486412974210680, -0.00210133607664653165869594886317, -0.00197304327737360309796832424922, -0.00184087079476779528867946833515, -0.00170757486600656063074898938225, -0.00157562764933866531966155655198, -0.00144719893619200739784402820476, -0.00132414359316993814584539901347, -0.00120799473833384241050481477942, -0.00109996256583001295395463081661, -0.00100093864561785566257012813907, -0.00091150544211925045232081110669, -0.00083195071827581840943205415684, -0.00076228642090910773802814315303, -0.00070227158044454483093455010589, -0.00065143870386470182666516226533, -0.00060912309493449086697514083255, -0.00057449450086537775638645397791};
const float HPF_COEFFS[] = {-0.00028934607426817749538036639301, -0.00030525119825543516223487205963, -0.00032564830249409037381605469541, -0.00035107529243613374864835252609, -0.00038205895699208210344530178837, -0.00041911158261758065099109038520, -0.00046272759938248360410753545757, -0.00051338027864419530366113519904, -0.00057151850182018634240199705943, -0.00063756361951252174796039851046, -0.00071190641988062223870226130629, -0.00079490422468884503522795759167, -0.00088687813087487865799929398491, -0.00098811041479629209242918630451, -0.00109884211551923311606104860516, -0.00121927081261944520416962145504, -0.00134954861297609837560151913038, -0.00148978035995883748704438076516, -0.00164002207724375554005746824515, -0.00180027965825114663091233158099, -0.00197050781088380913205759803475, -0.00215060926586673958893491942490, -0.00234043425555500094956129508716, -0.00253978026859459941541596883496, -0.00274839208429976129127725315016, -0.00296596208905784350373657787259, -0.00319213087549915282975510066876, -0.00342648812358235669087158647983, -0.00366857376115608656980127122438, -0.00391787939997316307649821709447, -0.00417385004156472193270754900141, -0.00443588604583680483350871526227, -0.00470334535374061779577914421679, -0.00497554595389872959115828976451, -0.00525176858165163178149281719698, -0.00553125963763077994894690192496, -0.00581323431167356068083318376694, -0.00609687989668038742008260300054, -0.00638135927588155075357301271310, -0.00666581456593850953801227987583, -0.00694937089735715284727346485738, -0.00723114031284521809744836318146, -0.00751022576350753208462851517879, -0.00778572518214570331862578456139, -0.00805673561241735530780161411712, -0.00832235737221705129673665624068, -0.00858169822936941800728405382870, -0.00883387756757666835205622390959, -0.00907803052053833894885492838966, -0.00931331205226177717693136770549, -0.00953890096180686451743380160906, -0.00975400379105667916790345373101, -0.00995785861457599077994906622280, -0.01014973869120818633637881589493, -0.01032895595776656474940047303335, -0.01049486434599269241152441622944, -0.01064686290487918372826836588274, -0.01078439871148109685528027057444, -0.01090696955446358168417830825092, -0.01101412637584703486937076633012, -0.01110547545770796361297438892279, -0.01118068034196665477830734403142, -0.01123946347283369395775309840246, -0.01128160755298823758607795753051, -0.01130695660611303124398752117941, 0.98868458325999430957864433366922, -0.01130695660611303124398752117941, -0.01128160755298823758607795753051, -0.01123946347283369222302962242566, -0.01118068034196665477830734403142, -0.01110547545770796361297438892279, -0.01101412637584703313464729035331, -0.01090696955446358168417830825092, -0.01078439871148109685528027057444, -0.01064686290487918372826836588274, -0.01049486434599269241152441622944, -0.01032895595776656474940047303335, -0.01014973869120818633637881589493, -0.00995785861457599077994906622280, -0.00975400379105667916790345373101, -0.00953890096180686451743380160906, -0.00931331205226178064637831965911, -0.00907803052053834068357840436647, -0.00883387756757666661733274793278, -0.00858169822936941974200752980551, -0.00832235737221705129673665624068, -0.00805673561241735704252509009393, -0.00778572518214570678807273651501, -0.00751022576350753468671372914400, -0.00723114031284521723008662519305, -0.00694937089735715544935867882259, -0.00666581456593851127273575585264, -0.00638135927588155162093475070151, -0.00609687989668039175689129294256, -0.00581323431167355981347144577853, -0.00553125963763077908158516393655, -0.00525176858165163264885455518538, -0.00497554595389873045852002775291, -0.00470334535374061866314088220520, -0.00443588604583680483350871526227, -0.00417385004156472280006928698981, -0.00391787939997316220913647910606, -0.00366857376115608873820561619539, -0.00342648812358235799191419346243, -0.00319213087549915369711683865717, -0.00296596208905784350373657787259, -0.00274839208429976129127725315016, -0.00253978026859460201750118280017, -0.00234043425555500311796564005817, -0.00215060926586674132365839540171, -0.00197050781088380999941933602315, -0.00180027965825114749827406956939, -0.00164002207724375597373833723935, -0.00148978035995883900492742224486, -0.00134954861297609989348456061009, -0.00121927081261944455364831796373, -0.00109884211551923376658235209646, -0.00098811041479629209242918630451, -0.00088687813087487898325994573057, -0.00079490422468884633627056457428, -0.00071190641988062310606399929469, -0.00063756361951252142269974676481, -0.00057151850182018688450308330218, -0.00051338027864419562892178694469, -0.00046272759938248382094796995467, -0.00041911158261758086783152488231, -0.00038205895699208210344530178837, -0.00035107529243613374864835252609, -0.00032564830249409037381605469541, -0.00030525119825543516223487205963, -0.00028934607426817749538036639301};

typedef struct {
    float coeffs[NUM_TAPS];
    float state[NUM_TAPS - 1];
} filter_fir_t;

void filter_fir_apply(filter_fir_t* filter, float* input, uint16_t input_size, float* output);
void apply_data_compensation(int32_t* arr, uint16_t len, filter_fir_t* lowpass_filter, filter_fir_t* bandpass_filter, filter_fir_t* highpass_filter);

#endif
