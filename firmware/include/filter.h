#ifndef __FILTER_H
#define __FILTER_H

#include <math.h>
#include <stdint.h>
#include <string.h>

#define NUM_TAPS 131

const float LPF_COEFFS[] = {0.00015558904598903335915471846107, 0.00015676826428719287977175955717, 0.00016003782844493613202012383123, 0.00016539557629002561277981042664, 0.00017283428624708112482377675434, 0.00018234168682964936917222098511, 0.00019390047855816848585037981412, 0.00020748836826760895632633385777, 0.00022307811573746202113768810626, 0.00024063759254578292795176408525, 0.00026012985301822512266070597242, 0.00028151321711253134930791341972, 0.00030474136504882675356709054171, 0.00032976344346640043591126212341, 0.00035652418285849743137538858662, 0.00038496402600810252772264852261, 0.00041501926711978617519707701611, 0.00044662220131554819643401876839, 0.00047970128413624336287737759399, 0.00051418130066470672974443534287, 0.00054998354386217283579912917801, 0.00058702600168606864326770189422, 0.00062522355253480539887672717825, 0.00066448816854386861131126496005, 0.00070472912623736417084274741285, 0.00074585322402026467576707791096, 0.00078776500597896965613631259373, 0.00083036699144149457400831959575, 0.00087355990973367401552368560758, 0.00091724293955424405534737619661, 0.00096131395237959423125811975197, 0.00100566975929839092299133973540, 0.00105020636066717465428865807553, 0.00109481919797048670578432094658, 0.00113940340726306071905682415490, 0.00118385407356718362105463260292, 0.00122806648559546801278974381688, 0.00127193639016799512134192617907, 0.00131536024569312405899101925399, 0.00135823547408315701764958127740, 0.00140046071047956913017962232715, 0.00144193605016756736490746160229, 0.00148256329206642692604412037127, 0.00152224617819022006032225746708, 0.00156089062848331671176649315669, 0.00159840497044626316316962011399, 0.00163470016298036661429871063689, 0.00166969001389351127430382693007, 0.00170329139052528355860460784754, 0.00173542442296647516329632932042, 0.00176601269936630723457471336957, 0.00179498345284030908289296668556, 0.00182226773951259962171234096928, 0.00184780060724831036653159621608, 0.00187152125465502527056071979672, 0.00189337317995632052267107603427, 0.00191330431936566672766752983392, 0.00193126717461513416722318492447, 0.00194721892932036406108353698841, 0.00196112155389109804951019988550, 0.00197294189872515091446758539462, 0.00198265177545295856118001687207, 0.00199022802602964385410011516342, 0.00199565257950194913441621658023, 0.00199891249630811595680568437672, 0.00200000000000000004163336342344, 0.00199891249630811595680568437672, 0.00199565257950194913441621658023, 0.00199022802602964385410011516342, 0.00198265177545295856118001687207, 0.00197294189872515091446758539462, 0.00196112155389109804951019988550, 0.00194721892932036406108353698841, 0.00193126717461513438406361942157, 0.00191330431936566672766752983392, 0.00189337317995632052267107603427, 0.00187152125465502527056071979672, 0.00184780060724831036653159621608, 0.00182226773951259962171234096928, 0.00179498345284030908289296668556, 0.00176601269936630723457471336957, 0.00173542442296647559697719831462, 0.00170329139052528399228547684174, 0.00166969001389351084062295793586, 0.00163470016298036683113914513399, 0.00159840497044626338001005461109, 0.00156089062848331692860692765379, 0.00152224617819022071084356095838, 0.00148256329206642757656542386258, 0.00144193605016756714806702710518, 0.00140046071047956956386049132135, 0.00135823547408315745133045027160, 0.00131536024569312427583145375110, 0.00127193639016799598870366416747, 0.00122806648559546779594930931978, 0.00118385407356718340421419810582, 0.00113940340726306093589725865201, 0.00109481919797048692262475544368, 0.00105020636066717487112909257263, 0.00100566975929839092299133973540, 0.00096131395237959433967833700052, 0.00091724293955424383850694169951, 0.00087355990973367444920455460178, 0.00083036699144149489926897134140, 0.00078776500597896987297674709083, 0.00074585322402026467576707791096, 0.00070472912623736417084274741285, 0.00066448816854386937025278569990, 0.00062522355253480604939803066955, 0.00058702600168606907694857088842, 0.00054998354386217305263956367511, 0.00051418130066470694658486983997, 0.00047970128413624347129759484254, 0.00044662220131554863011488776259, 0.00041501926711978660887794601031, 0.00038496402600810231088221402551, 0.00035652418285849764821582308372, 0.00032976344346640043591126212341, 0.00030474136504882686198730779026, 0.00028151321711253178298878241392, 0.00026012985301822544792135771807, 0.00024063759254578281953154683670, 0.00022307811573746223797812260337, 0.00020748836826760906474655110632, 0.00019390047855816859427059706267, 0.00018234168682964947759243823366, 0.00017283428624708112482377675434, 0.00016539557629002561277981042664, 0.00016003782844493613202012383123, 0.00015676826428719287977175955717, 0.00015558904598903335915471846107};
const float BPF_COEFFS[] = {-0.00042989081506524944335453919386, -0.00047386889883924799638306724070, -0.00052553320046463307749218252241, -0.00058619416034576721404036891983, -0.00065708827343672173218469545475, -0.00073932978239971190812657164670, -0.00083386241807704541539186804400, -0.00094141220768684816602722698065, -0.00106244237857395910397395599745, -0.00119711137344081976902065989066, -0.00134523496163810123670001583918, -0.00150625338055649315126272025367, -0.00167920437203020970345912488142, -0.00186270289188941859034875925261, -0.00205492816766824053925644122387, -0.00225361866158942797389030943123, -0.00245607536519883585396373248955, -0.00265917371056551303173942635283, -0.00285938423317324413863715903972, -0.00305280196606736147629801436665, -0.00323518438618658563804553196519, -0.00340199757489610243171851422517, -0.00354847009838087481051194238546, -0.00366965396258595857523210348461, -0.00376049185457433873119859057965, -0.00381588975017505297945841213902, -0.00383079384912124367573715844060, -0.00380027069583192388807502126724, -0.00371958925862925617392140686945, -0.00358430367427622475345883046316, -0.00339033531971900210441606127176, -0.00313405284992712435815365168423, -0.00281234884047391322722808659762, -0.00242271169633253603825639999059, -0.00196329153422497787798151058780, -0.00143295881429641894060089679641, -0.00083135458704427416323778921026, -0.00015893133207243526419660817339, 0.00058301650523687458416849382914, 0.00139233302658441993396309932507, 0.00226599302946476960016197743641, 0.00320010620476166799536210660904, 0.00418993361359884432942868315308, 0.00522991648472011325804453818478, 0.00631371718122932402278424390829, 0.00743427199290225878408611137615, 0.00858385522068982019516791837077, 0.00975415383664104615468737335959, 0.01093635182838136564453801469199, 0.01212122317544927010968258684898, 0.01329923225799957593740163730445, 0.01446064036916749721839448028504, 0.01559561689301828049658560360058, 0.01669435362242705986335344903182, 0.01774718062703389484524585384406, 0.01874468204180664704372460960258, 0.01967781013252242403033243078880, 0.02053799600602839586782621950078, 0.02131725537041740184407423441826, 0.02200828781277761048151830891584, 0.02260456814904772404606347890876, 0.02310042851042392111904355544993, 0.02349112996202432426806616660997, 0.02377292260006831289831374931509, 0.02394309324128866475756005627318, 0.02400000000000000049960036108132, 0.02394309324128866475756005627318, 0.02377292260006831289831374931509, 0.02349112996202432079861921465636, 0.02310042851042392111904355544993, 0.02260456814904772404606347890876, 0.02200828781277760701207135696222, 0.02131725537041740184407423441826, 0.02053799600602839586782621950078, 0.01967781013252242403033243078880, 0.01874468204180664704372460960258, 0.01774718062703389484524585384406, 0.01669435362242705986335344903182, 0.01559561689301828049658560360058, 0.01446064036916749721839448028504, 0.01329923225799957593740163730445, 0.01212122317544927357912953880259, 0.01093635182838136737926149066880, 0.00975415383664104268524042140598, 0.00858385522068982192989139434758, 0.00743427199290226051880958735296, 0.00631371718122932489014598189669, 0.00522991648472011586012975214999, 0.00418993361359884606415215912989, 0.00320010620476166756168123761483, 0.00226599302946477046752371542482, 0.00139233302658442036764396831927, 0.00058301650523687469258871107769, -0.00015893133207243537261682542194, -0.00083135458704427405481757196171, -0.00143295881429641872376046229931, -0.00196329153422497787798151058780, -0.00242271169633253647193726898479, -0.00281234884047391366090895559182, -0.00313405284992712435815365168423, -0.00339033531971900253809693026597, -0.00358430367427622388609709247476, -0.00371958925862925790864488284626, -0.00380027069583192562279849724405, -0.00383079384912124497677976542320, -0.00381588975017505297945841213902, -0.00376049185457433873119859057965, -0.00366965396258596204467905543822, -0.00354847009838087827995889433907, -0.00340199757489610503380372819038, -0.00323518438618658693908813894780, -0.00305280196606736277734062134925, -0.00285938423317324457231802803392, -0.00265917371056551563382464031804, -0.00245607536519883845604894645476, -0.00225361866158942667284770244862, -0.00205492816766824184029904820648, -0.00186270289188941859034875925261, -0.00167920437203021013713999387562, -0.00150625338055649553650749972178, -0.00134523496163810297142349181598, -0.00119711137344081911849935639935, -0.00106244237857396018817612848295, -0.00094141220768684859970809597485, -0.00083386241807704584907273703820, -0.00073932978239971234180744064091, -0.00065708827343672173218469545475, -0.00058619416034576721404036891983, -0.00052553320046463307749218252241, -0.00047386889883924799638306724070, -0.00042989081506524944335453919386};
const float HPF_COEFFS[] = {-0.00015558904598903335915471846107, -0.00015676826428719287977175955717, -0.00016003782844493613202012383123, -0.00016539557629002561277981042664, -0.00017283428624708112482377675434, -0.00018234168682964936917222098511, -0.00019390047855816848585037981412, -0.00020748836826760895632633385777, -0.00022307811573746202113768810626, -0.00024063759254578292795176408525, -0.00026012985301822512266070597242, -0.00028151321711253134930791341972, -0.00030474136504882675356709054171, -0.00032976344346640043591126212341, -0.00035652418285849743137538858662, -0.00038496402600810252772264852261, -0.00041501926711978617519707701611, -0.00044662220131554819643401876839, -0.00047970128413624336287737759399, -0.00051418130066470672974443534287, -0.00054998354386217283579912917801, -0.00058702600168606864326770189422, -0.00062522355253480539887672717825, -0.00066448816854386861131126496005, -0.00070472912623736417084274741285, -0.00074585322402026467576707791096, -0.00078776500597896965613631259373, -0.00083036699144149457400831959575, -0.00087355990973367401552368560758, -0.00091724293955424405534737619661, -0.00096131395237959423125811975197, -0.00100566975929839092299133973540, -0.00105020636066717465428865807553, -0.00109481919797048670578432094658, -0.00113940340726306071905682415490, -0.00118385407356718362105463260292, -0.00122806648559546801278974381688, -0.00127193639016799512134192617907, -0.00131536024569312405899101925399, -0.00135823547408315701764958127740, -0.00140046071047956913017962232715, -0.00144193605016756736490746160229, -0.00148256329206642692604412037127, -0.00152224617819022006032225746708, -0.00156089062848331671176649315669, -0.00159840497044626316316962011399, -0.00163470016298036661429871063689, -0.00166969001389351127430382693007, -0.00170329139052528355860460784754, -0.00173542442296647516329632932042, -0.00176601269936630723457471336957, -0.00179498345284030908289296668556, -0.00182226773951259962171234096928, -0.00184780060724831036653159621608, -0.00187152125465502527056071979672, -0.00189337317995632052267107603427, -0.00191330431936566672766752983392, -0.00193126717461513416722318492447, -0.00194721892932036406108353698841, -0.00196112155389109804951019988550, -0.00197294189872515091446758539462, -0.00198265177545295856118001687207, -0.00199022802602964385410011516342, -0.00199565257950194913441621658023, -0.00199891249630811595680568437672, 0.99799999999999999822364316059975, -0.00199891249630811595680568437672, -0.00199565257950194913441621658023, -0.00199022802602964385410011516342, -0.00198265177545295856118001687207, -0.00197294189872515091446758539462, -0.00196112155389109804951019988550, -0.00194721892932036406108353698841, -0.00193126717461513438406361942157, -0.00191330431936566672766752983392, -0.00189337317995632052267107603427, -0.00187152125465502527056071979672, -0.00184780060724831036653159621608, -0.00182226773951259962171234096928, -0.00179498345284030908289296668556, -0.00176601269936630723457471336957, -0.00173542442296647559697719831462, -0.00170329139052528399228547684174, -0.00166969001389351084062295793586, -0.00163470016298036683113914513399, -0.00159840497044626338001005461109, -0.00156089062848331692860692765379, -0.00152224617819022071084356095838, -0.00148256329206642757656542386258, -0.00144193605016756714806702710518, -0.00140046071047956956386049132135, -0.00135823547408315745133045027160, -0.00131536024569312427583145375110, -0.00127193639016799598870366416747, -0.00122806648559546779594930931978, -0.00118385407356718340421419810582, -0.00113940340726306093589725865201, -0.00109481919797048692262475544368, -0.00105020636066717487112909257263, -0.00100566975929839092299133973540, -0.00096131395237959433967833700052, -0.00091724293955424383850694169951, -0.00087355990973367444920455460178, -0.00083036699144149489926897134140, -0.00078776500597896987297674709083, -0.00074585322402026467576707791096, -0.00070472912623736417084274741285, -0.00066448816854386937025278569990, -0.00062522355253480604939803066955, -0.00058702600168606907694857088842, -0.00054998354386217305263956367511, -0.00051418130066470694658486983997, -0.00047970128413624347129759484254, -0.00044662220131554863011488776259, -0.00041501926711978660887794601031, -0.00038496402600810231088221402551, -0.00035652418285849764821582308372, -0.00032976344346640043591126212341, -0.00030474136504882686198730779026, -0.00028151321711253178298878241392, -0.00026012985301822544792135771807, -0.00024063759254578281953154683670, -0.00022307811573746223797812260337, -0.00020748836826760906474655110632, -0.00019390047855816859427059706267, -0.00018234168682964947759243823366, -0.00017283428624708112482377675434, -0.00016539557629002561277981042664, -0.00016003782844493613202012383123, -0.00015676826428719287977175955717, -0.00015558904598903335915471846107};

typedef struct {
    float coeffs[NUM_TAPS];
    float state[NUM_TAPS - 1];
} filter_fir_t;

void filter_fir_apply(filter_fir_t* filter, float* input, uint16_t input_size, float* output);
void apply_data_compensation(int32_t* arr, uint16_t len, filter_fir_t* lowpass_filter, filter_fir_t* bandpass_filter, filter_fir_t* highpass_filter);

#endif
