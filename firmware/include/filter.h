#ifndef __FILTER_H
#define __FILTER_H

#include <math.h>
#include <stdint.h>
#include <string.h>

#define NUM_TAPS 141

const float LPF_COEFFS[] = {0.00028029940869836000687242982821, 0.00028301234680966986991673683960, 0.00028899191593205779057806914523, 0.00029826456514338598943747449255, 0.00031084905657228947394726814579, 0.00032675637269246520042603743050, 0.00034598964268880457026064667581, 0.00036854408817199796940394795897, 0.00039440698846810329919465587523, 0.00042355766565864492838311416989, 0.00045596748949526218815803124684, 0.00049159990226084514589044438537, 0.00053041046359668224136757475051, 0.00057234691526249659599551167233, 0.00061734926574353319109200732839, 0.00066534989456620580866585967783, 0.00071627367613138928463534238489, 0.00077003812282235104685890192400, 0.00082655354709276719279986700428, 0.00088572324218931682265204541338, 0.00094744368111322155735082306549, 0.00101160473337587363332201739752, 0.00107808989905553939160631760075, 0.00114677655961517035131114194968, 0.00121753624489570849535879926151, 0.00129023491565510503575886502858, 0.00136473326098067102019051333173, 0.00144088700986145590646203551444, 0.00151854725616829173973076905213, 0.00159756079625194722867997931814, 0.00167777047833471111906722406104, 0.00175901556283771919736436117887, 0.00184113209275554704814903406174, 0.00192395327316111715461321995946, 0.00200730985889789994083831636829, 0.00209103054949275404816866341662, 0.00217494239030170200335789765234, 0.00225887117888244268182340590556, 0.00234264187557158432700932237935, 0.00242607901723146434161404449981, 0.00250900713312103389174279044482, 0.00259125116183768749306137735289, 0.00267263686827210302301982558504, 0.00275299125951615659968485516629, 0.00283214299866482201173401023198, 0.00290992281545662508437932736172, 0.00298616391270366352689302757994, 0.00306070236747154039019802596044, 0.00313337752598159650918585583668, 0.00320403239122263316929206666828, 0.00327251400227690546554382144961, 0.00333867380438533818687307785922, 0.00340236800879975282568823402585, 0.00346345794149533793560014061086, 0.00352181037984439443758177823440, 0.00357729787638281669301387744042, 0.00362979906883330837030765536610, 0.00367919897558432540743411642836, 0.00372538927586077255049712420032, 0.00376826857386160490176463255807, 0.00380774264618060319376180444806, 0.00384372467186952200893235165324, 0.00387613544454745544143303703777, 0.00390490356600658875332876540654, 0.00392996562081225284113195073132, 0.00395126633144432699851211765463, 0.00396875869357740749393537171841, 0.00398240409114858362471522923443, 0.00399217239091407410933598498559, 0.00399804201624920103191884734883, 0.00400000000000000008326672684689, 0.00399804201624920103191884734883, 0.00399217239091407410933598498559, 0.00398240409114858362471522923443, 0.00396875869357740749393537171841, 0.00395126633144432699851211765463, 0.00392996562081225370849368871973, 0.00390490356600658962069050339494, 0.00387613544454745587511390603197, 0.00384372467186952244261322064744, 0.00380774264618060319376180444806, 0.00376826857386160533544550155227, 0.00372538927586077298417799319452, 0.00367919897558432540743411642836, 0.00362979906883330837030765536610, 0.00357729787638281712669474643462, 0.00352181037984439487126264722860, 0.00346345794149533880296187859926, 0.00340236800879975369304997201425, 0.00333867380438533818687307785922, 0.00327251400227690633290555943802, 0.00320403239122263360297293566248, 0.00313337752598159694286672483088, 0.00306070236747154125755976394885, 0.00298616391270366352689302757994, 0.00290992281545662551806019635592, 0.00283214299866482287909574822038, 0.00275299125951615659968485516629, 0.00267263686827210389038156357344, 0.00259125116183768836042311534129, 0.00250900713312103432542365943902, 0.00242607901723146477529491349401, 0.00234264187557158476069019137356, 0.00225887117888244268182340590556, 0.00217494239030170243703876664654, 0.00209103054949275448184953241082, 0.00200730985889790037451918536249, 0.00192395327316111758829408895366, 0.00184113209275554748182990305594, 0.00175901556283771963104523017307, 0.00167777047833471155274809305524, 0.00159756079625194766236084831235, 0.00151854725616829217341163804633, 0.00144088700986145634014290450864, 0.00136473326098067145387138232593, 0.00129023491565510546943973402279, 0.00121753624489570871219923375861, 0.00114677655961517078499201094388, 0.00107808989905554004212762109205, 0.00101160473337587406700288639172, 0.00094744368111322199103169205969, 0.00088572324218931725633291440758, 0.00082655354709276762648073599848, 0.00077003812282235126369933642110, 0.00071627367613138950147577688199, 0.00066534989456620602550629417493, 0.00061734926574353319109200732839, 0.00057234691526249659599551167233, 0.00053041046359668245820800924761, 0.00049159990226084536273087888247, 0.00045596748949526235078835711967, 0.00042355766565864514522354866699, 0.00039440698846810346182498174805, 0.00036854408817199818624438245607, 0.00034598964268880457026064667581, 0.00032675637269246520042603743050, 0.00031084905657228969078770264289, 0.00029826456514338620627790898965, 0.00028899191593205800741850364233, 0.00028301234680966986991673683960, 0.00028029940869836000687242982821};
const float BPF_COEFFS[] = {-0.00065329323587415765676317258581, -0.00063635680418629950606118628187, -0.00061833612391287977750470306049, -0.00059830469814021124651259864180, -0.00057505640802957833698089151753, -0.00054720139639141836783442496284, -0.00051328536076662397476949584174, -0.00047192729963749506950226875190, -0.00042196961893527739056314329602, -0.00036263358421375127809554994585, -0.00029367244128834362479688047110, -0.00021551416057552898533633545242, -0.00012938571323296380066215915949, -0.00003741107435905189330547712667, 0.00005732422854872570286335203837, 0.00015074825620746919500013427662, 0.00023782247347405981868773139354, 0.00031260971411768061298946941307, 0.00036839203776180154490532681066, 0.00039783833135793536138133386082, 0.00039321952045657447517498783718, 0.00034666724262215901008685192686, 0.00025046987022657045450849122581, 0.00009739792692317637346540587506, -0.00011895070618167356705022208452, -0.00040379678436384502764056048107, -0.00076082894516175882289321652507, -0.00119186894590980405062019542584, -0.00169656590547418687116298929851, -0.00227213239441997980755383323981, -0.00291313459613824505406443066136, -0.00361134768959606340665846602178, -0.00435568610117892211774925925738, -0.00513221637280358768812282832528, -0.00592425814493647076575122412123, -0.00671257621852873985479615015493, -0.00747566391289729813285358517305, -0.00819011506030485787743788961279, -0.00883107906226239351699103252713, -0.00937279057115423912260876448954, -0.00978916264831314851535548626771, -0.01005442977854415463612181014241, -0.01014382497834254506785534033497, -0.01003427349934627940686304725659, -0.00970508436745228832143173036684, -0.00913862026547550103383610320407, -0.00832092610158496545635919972028, -0.00724229702817378966084316260776, -0.00589776768926353420902097823841, -0.00428750606331843985702390043002, -0.00241709739827595257791181815321, -0.00029770635480117965936813773098, 0.00205389148599622369667505594748, 0.00461541421556826373523430007140, 0.00735931613464833184190538872826, 0.01025316631480122954445111105315, 0.01326015747436943940928966156889, 0.01633973574982203191829910338129, 0.01944833842976956966852597474826, 0.02254022350743626820768206187040, 0.02556837209784543207824469845946, 0.02848544244704747513408094050646, 0.03124475250719881830319124560447, 0.03380126692164233531689987444224, 0.03611256379850290298971771107972, 0.03813975687015417476155576537167, 0.03984834953921776584673253296387, 0.04120899887889431512100202326110, 0.04219816984567315715226598626941, 0.04279866271615485884272089833757, 0.04300000000000000349720252756924, 0.04279866271615485884272089833757, 0.04219816984567315715226598626941, 0.04120899887889432205989592716833, 0.03984834953921776584673253296387, 0.03813975687015417476155576537167, 0.03611256379850290298971771107972, 0.03380126692164234225579377834947, 0.03124475250719882177263819755808, 0.02848544244704747860352789246008, 0.02556837209784543207824469845946, 0.02254022350743627167712901382401, 0.01944833842976956966852597474826, 0.01633973574982203191829910338129, 0.01326015747436943940928966156889, 0.01025316631480123127917458702996, 0.00735931613464833270926712671667, 0.00461541421556826460259603805980, 0.00205389148599622413035592494168, -0.00029770635480117965936813773098, -0.00241709739827595344527355614161, -0.00428750606331843985702390043002, -0.00589776768926353507638271622682, -0.00724229702817379226292837657297, -0.00832092610158496545635919972028, -0.00913862026547550276855957918087, -0.00970508436745229179087868232045, -0.01003427349934627940686304725659, -0.01014382497834254853730229228859, -0.01005442977854415810556876209603, -0.00978916264831315025007896224452, -0.00937279057115424085733224046635, -0.00883107906226239525171450850394, -0.00819011506030485787743788961279, -0.00747566391289729900021532316146, -0.00671257621852874158951962613173, -0.00592425814493647163311296210964, -0.00513221637280358855548456631368, -0.00435568610117892298511099724578, -0.00361134768959606427402020401018, -0.00291313459613824548774529965556, -0.00227213239441998067491557122821, -0.00169656590547418752168429278981, -0.00119186894590980448430106442004, -0.00076082894516175903973365102217, -0.00040379678436384513606077772963, -0.00011895070618167358060274924059, 0.00009739792692317640057046018720, 0.00025046987022657061713881709863, 0.00034666724262215917271717779968, 0.00039321952045657463780531371000, 0.00039783833135793552401165973365, 0.00036839203776180176174576130776, 0.00031260971411768072140968666162, 0.00023782247347405990000289432995, 0.00015074825620746922210518858876, 0.00005732422854872570286335203837, -0.00003741107435905189330547712667, -0.00012938571323296385487226778377, -0.00021551416057552906665149838883, -0.00029367244128834378742720634392, -0.00036263358421375144072587581867, -0.00042196961893527760740357779312, -0.00047192729963749534055281187328, -0.00051328536076662397476949584174, -0.00054720139639141836783442496284, -0.00057505640802957877066176051173, -0.00059830469814021168019346763600, -0.00061833612391288021118557205469, -0.00063635680418629950606118628187, -0.00065329323587415765676317258581};
const float HPF_COEFFS[] = {-0.00028029940869836000687242982821, -0.00028301234680966986991673683960, -0.00028899191593205779057806914523, -0.00029826456514338598943747449255, -0.00031084905657228947394726814579, -0.00032675637269246520042603743050, -0.00034598964268880457026064667581, -0.00036854408817199796940394795897, -0.00039440698846810329919465587523, -0.00042355766565864492838311416989, -0.00045596748949526218815803124684, -0.00049159990226084514589044438537, -0.00053041046359668224136757475051, -0.00057234691526249659599551167233, -0.00061734926574353319109200732839, -0.00066534989456620580866585967783, -0.00071627367613138928463534238489, -0.00077003812282235104685890192400, -0.00082655354709276719279986700428, -0.00088572324218931682265204541338, -0.00094744368111322155735082306549, -0.00101160473337587363332201739752, -0.00107808989905553939160631760075, -0.00114677655961517035131114194968, -0.00121753624489570849535879926151, -0.00129023491565510503575886502858, -0.00136473326098067102019051333173, -0.00144088700986145590646203551444, -0.00151854725616829173973076905213, -0.00159756079625194722867997931814, -0.00167777047833471111906722406104, -0.00175901556283771919736436117887, -0.00184113209275554704814903406174, -0.00192395327316111715461321995946, -0.00200730985889789994083831636829, -0.00209103054949275404816866341662, -0.00217494239030170200335789765234, -0.00225887117888244268182340590556, -0.00234264187557158432700932237935, -0.00242607901723146434161404449981, -0.00250900713312103389174279044482, -0.00259125116183768749306137735289, -0.00267263686827210302301982558504, -0.00275299125951615659968485516629, -0.00283214299866482201173401023198, -0.00290992281545662508437932736172, -0.00298616391270366352689302757994, -0.00306070236747154039019802596044, -0.00313337752598159650918585583668, -0.00320403239122263316929206666828, -0.00327251400227690546554382144961, -0.00333867380438533818687307785922, -0.00340236800879975282568823402585, -0.00346345794149533793560014061086, -0.00352181037984439443758177823440, -0.00357729787638281669301387744042, -0.00362979906883330837030765536610, -0.00367919897558432540743411642836, -0.00372538927586077255049712420032, -0.00376826857386160490176463255807, -0.00380774264618060319376180444806, -0.00384372467186952200893235165324, -0.00387613544454745544143303703777, -0.00390490356600658875332876540654, -0.00392996562081225284113195073132, -0.00395126633144432699851211765463, -0.00396875869357740749393537171841, -0.00398240409114858362471522923443, -0.00399217239091407410933598498559, -0.00399804201624920103191884734883, 0.99599999999999999644728632119950, -0.00399804201624920103191884734883, -0.00399217239091407410933598498559, -0.00398240409114858362471522923443, -0.00396875869357740749393537171841, -0.00395126633144432699851211765463, -0.00392996562081225370849368871973, -0.00390490356600658962069050339494, -0.00387613544454745587511390603197, -0.00384372467186952244261322064744, -0.00380774264618060319376180444806, -0.00376826857386160533544550155227, -0.00372538927586077298417799319452, -0.00367919897558432540743411642836, -0.00362979906883330837030765536610, -0.00357729787638281712669474643462, -0.00352181037984439487126264722860, -0.00346345794149533880296187859926, -0.00340236800879975369304997201425, -0.00333867380438533818687307785922, -0.00327251400227690633290555943802, -0.00320403239122263360297293566248, -0.00313337752598159694286672483088, -0.00306070236747154125755976394885, -0.00298616391270366352689302757994, -0.00290992281545662551806019635592, -0.00283214299866482287909574822038, -0.00275299125951615659968485516629, -0.00267263686827210389038156357344, -0.00259125116183768836042311534129, -0.00250900713312103432542365943902, -0.00242607901723146477529491349401, -0.00234264187557158476069019137356, -0.00225887117888244268182340590556, -0.00217494239030170243703876664654, -0.00209103054949275448184953241082, -0.00200730985889790037451918536249, -0.00192395327316111758829408895366, -0.00184113209275554748182990305594, -0.00175901556283771963104523017307, -0.00167777047833471155274809305524, -0.00159756079625194766236084831235, -0.00151854725616829217341163804633, -0.00144088700986145634014290450864, -0.00136473326098067145387138232593, -0.00129023491565510546943973402279, -0.00121753624489570871219923375861, -0.00114677655961517078499201094388, -0.00107808989905554004212762109205, -0.00101160473337587406700288639172, -0.00094744368111322199103169205969, -0.00088572324218931725633291440758, -0.00082655354709276762648073599848, -0.00077003812282235126369933642110, -0.00071627367613138950147577688199, -0.00066534989456620602550629417493, -0.00061734926574353319109200732839, -0.00057234691526249659599551167233, -0.00053041046359668245820800924761, -0.00049159990226084536273087888247, -0.00045596748949526235078835711967, -0.00042355766565864514522354866699, -0.00039440698846810346182498174805, -0.00036854408817199818624438245607, -0.00034598964268880457026064667581, -0.00032675637269246520042603743050, -0.00031084905657228969078770264289, -0.00029826456514338620627790898965, -0.00028899191593205800741850364233, -0.00028301234680966986991673683960, -0.00028029940869836000687242982821};

typedef struct {
    float coeffs[NUM_TAPS];
    float state[NUM_TAPS - 1];
} filter_fir_t;

void filter_fir_apply(filter_fir_t* filter, float* input, uint16_t input_size, float* output);
void apply_data_compensation(int32_t* arr, uint16_t len, filter_fir_t* lowpass_filter, filter_fir_t* bandpass_filter, filter_fir_t* highpass_filter);

#endif
